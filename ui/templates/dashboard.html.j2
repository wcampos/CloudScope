{% extends "base.html.j2" %}

{% block title %}Resources - AWS Inventory{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Account Info Alert -->
    <div class="alert alert-info d-flex justify-content-between align-items-center">
        <div>
            <strong>AWS Account:</strong> {{ account_info.account }} | 
            <strong>Region:</strong> {{ account_info.region }}
        </div>
        <form action="{{ url_for('refresh_resources') }}" method="post" class="d-inline">
            <button type="submit" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-sync-alt"></i> Refresh Cache
            </button>
        </form>
    </div>

    <!-- View Tabs -->
    <ul class="nav nav-tabs mb-4">
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'summary' %}active{% endif %}" href="{{ url_for('dashboard', view='summary') }}">Summary</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'compute' %}active{% endif %}" href="{{ url_for('dashboard', view='compute') }}">Compute</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'ec2_other' %}active{% endif %}" href="{{ url_for('dashboard', view='ec2_other') }}">EC2 Other</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'storage' %}active{% endif %}" href="{{ url_for('dashboard', view='storage') }}">Storage</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'data' %}active{% endif %}" href="{{ url_for('dashboard', view='data') }}">Data</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'network' %}active{% endif %}" href="{{ url_for('dashboard', view='network') }}">Network</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'route53' %}active{% endif %}" href="{{ url_for('dashboard', view='route53') }}">Route53</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'acm' %}active{% endif %}" href="{{ url_for('dashboard', view='acm') }}">ACM</a>
        </li>
        <li class="nav-item">
            <a class="nav-link {% if current_view == 'service' %}active{% endif %}" href="{{ url_for('dashboard', view='service') }}">Service</a>
        </li>
    </ul>

    <!-- Summary View -->
    {% if current_view == 'summary' %}
    <div class="row">
        <div class="col-12">
            <h4>Resource Summary</h4>
        </div>
        
        <!-- Compute Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Compute</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['EC2 Instances', 'ECS Clusters', 'EKS Clusters', 'Lambda Functions', 'Elastic Beanstalk Applications'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='compute') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- EC2 Other Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">EC2 Other</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['EC2 Volumes', 'EC2 AMIs', 'EC2 Snapshots'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='ec2_other') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Storage Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Storage</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['S3 Buckets', 'EBS Volumes', 'EFS File Systems'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='storage') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Data Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Data</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['RDS Instances', 'DynamoDB Tables', 'ElastiCache Clusters', 'Redshift Clusters', 'DocumentDB Clusters'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='data') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Network Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Network</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['VPCs', 'Subnets', 'Security Groups', 'Load Balancers', 'Route Tables'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='network') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Route53 Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Route53</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['Route53 Hosted Zones', 'Route53 Records'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='route53') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- ACM Resources -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">ACM</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name in ['SSL Certificates'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='acm') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <!-- Other Services -->
        <div class="col-12 mb-3">
            <h5 class="text-muted mb-2">Other Services</h5>
            <div class="row">
                {% for service_name, count in summary.items() %}
                    {% if service_name not in ['EC2 Instances', 'ECS Clusters', 'EKS Clusters', 'Lambda Functions', 'Elastic Beanstalk Applications',
                                            'EC2 Volumes', 'EC2 AMIs', 'EC2 Snapshots',
                                            'S3 Buckets', 'EBS Volumes', 'EFS File Systems',
                                            'RDS Instances', 'DynamoDB Tables', 'ElastiCache Clusters', 'Redshift Clusters', 'DocumentDB Clusters',
                                            'VPCs', 'Subnets', 'Security Groups', 'Load Balancers', 'Route Tables',
                                            'Route53 Hosted Zones', 'Route53 Records', 'SSL Certificates'] %}
                    <div class="col-md-3 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">{{ service_name }}</h6>
                                <a href="{{ url_for('dashboard', view='service') }}" class="card-text display-6 text-decoration-none">{{ count }}</a>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    <!-- Resources Display -->
    <div class="row">
        {% for service_name, items in resources.items() %}
        <div class="col-12 mb-4">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <button class="btn btn-link text-decoration-none p-0" type="button" 
                                data-bs-toggle="collapse" 
                                data-bs-target="#collapse-{{ loop.index }}" 
                                aria-expanded="false" 
                                aria-controls="collapse-{{ loop.index }}">
                            {{ service_name }} ({{ items|length }})
                        </button>
                    </h5>
                    <div class="spinner-border spinner-border-sm text-primary d-none" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
                <div class="collapse" id="collapse-{{ loop.index }}">
                    <div class="card-body">
                        {% if items %}
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        {% for key in items[0].keys() %}
                                        <th>{{ key }}</th>
                                        {% endfor %}
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in items %}
                                    <tr>
                                        {% for value in item.values() %}
                                        <td>{{ value }}</td>
                                        {% endfor %}
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        {% else %}
                        <div class="text-center text-muted">
                            <p>No resources found for this service.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Show loading spinner when refreshing cache
    const refreshButton = document.querySelector('button[type="submit"]');
    const spinners = document.querySelectorAll('.spinner-border');
    
    refreshButton.addEventListener('click', function() {
        spinners.forEach(spinner => spinner.classList.remove('d-none'));
    });
});
</script>
{% endblock %} 